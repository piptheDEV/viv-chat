<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Viv Chat</title>
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background-color: #121212;
    color: white;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  header {
    background-color: #00ffe1;
    color: black;
    padding: 15px;
    font-size: 1.2em;
    font-weight: bold;
    text-align: center;
    box-shadow: 0 0 10px rgba(0, 255, 225, 0.6);
  }

  #chat-box {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .message {
    max-width: 70%;
    padding: 10px;
    border-radius: 10px;
    font-size: 0.95em;
    line-height: 1.4;
    animation: fadeIn 0.3s ease-in-out;
  }

  .sent {
    background-color: #00ffe1;
    color: black;
    align-self: flex-end;
  }

  .received {
    background-color: #2a2a2a;
    color: white;
    align-self: flex-start;
  }

  .sender {
    font-size: 0.75em;
    color: #ccc;
    margin-bottom: 3px;
  }

  #input-area {
    display: flex;
    padding: 10px;
    background-color: #1e1e1e;
    border-top: 1px solid #333;
  }

  #message-input {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 6px;
    background-color: #2a2a2a;
    color: white;
  }

  #send-btn {
    background-color: #00ffe1;
    border: none;
    padding: 10px 15px;
    margin-left: 10px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }

  #send-btn:hover {
    background-color: #00ccba;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
<script src="https://unpkg.com/parse@3.4.4/dist/parse.min.js"></script>
<script>
  Parse.initialize("NtcUKphlkMFY9kWIbXMFjzMI3O66bx6Ns9MgCL3m", "TmpoEPhIIdwJsKvp6WS96mBeGI4VK2jRmdcSlXPf");
  Parse.serverURL = "https://parseapi.back4app.com/";

  let currentUser;

  async function loadMessages() {
    const Message = Parse.Object.extend("Message");
    const query = new Parse.Query(Message);
    query.ascending("createdAt");
    query.limit(50);
    const results = await query.find();
    const chatBox = document.getElementById("chat-box");
    chatBox.innerHTML = "";
    results.forEach(msg => {
      const sender = msg.get("sender");
      const text = msg.get("text");
      const div = document.createElement("div");
      div.classList.add("message");
      div.classList.add(sender === currentUser.getUsername() ? "sent" : "received");
      div.innerHTML = `<div class="sender">${sender}</div>${text}`;
      chatBox.appendChild(div);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  async function sendMessage() {
    const input = document.getElementById("message-input");
    const text = input.value.trim();
    if (!text) return;

    const Message = Parse.Object.extend("Message");
    const message = new Message();
    message.set("sender", currentUser.getUsername());
    message.set("text", text);
    await message.save();

    input.value = "";
    loadMessages();
  }

  async function init() {
    currentUser = Parse.User.current();
    if (!currentUser) {
      window.location.href = "index.html";
      return;
    }
    loadMessages();
    setInterval(loadMessages, 2000); // auto refresh every 2s
  }

  window.onload = init;
</script>
</head>
<body>
  <header>Viv Chat ðŸ’¬</header>
  <div id="chat-box"></div>
  <div id="input-area">
    <input type="text" id="message-input" placeholder="Type a message..." />
    <button id="send-btn" onclick="sendMessage()">Send</button>
  </div>
</body>
      </html>
