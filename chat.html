<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Viv-Chat</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #1e1e1e;
    color: white;
    display: flex;
    height: 100vh;
  }
  /* Side panel */
  .side-panel {
    width: 250px;
    background-color: #111;
    border-right: 1px solid #333;
    overflow-y: auto;
    padding: 10px;
  }
  .side-panel h2 {
    font-size: 18px;
    margin-top: 0;
    color: #0f9;
    text-align: center;
  }
  .user-item {
    padding: 8px;
    margin: 4px 0;
    background-color: #222;
    border-radius: 5px;
    cursor: pointer;
  }
  .user-item:hover {
    background-color: #333;
  }
  .user-item.self {
    background-color: #0f9;
    color: black;
  }
  /* Chat area */
  .chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
  }
  .message {
    max-width: 60%;
    padding: 8px;
    margin: 5px;
    border-radius: 8px;
  }
  .message.self {
    background-color: #0f9;
    color: black;
    align-self: flex-end;
  }
  .message.other {
    background-color: #333;
    color: white;
    align-self: flex-start;
  }
  .input-container {
    display: flex;
    border-top: 1px solid #333;
  }
  .input-container input {
    flex: 1;
    padding: 10px;
    border: none;
    outline: none;
    background: #222;
    color: white;
  }
  .input-container button {
    background: #0f9;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
    font-weight: bold;
  }
</style>
<script src="https://npmcdn.com/parse/dist/parse.min.js"></script>
<script>
  // Replace with your real Back4App keys
  Parse.initialize("NtcUKphlkMFY9kWIbXMFjzMI3O66bx6Ns9MgCL3m", "TmpoEPhIIdwJsKvp6WS96mBeGI4VK2jRmdcSlXPf");
  Parse.serverURL = "https://parseapi.back4app.com/";

  let currentUser = null;
  let selectedFriend = null;

  async function loadUsers() {
    const userListDiv = document.getElementById("userList");
    userListDiv.innerHTML = "<p>Loading users...</p>";

    try {
      const query = new Parse.Query(Parse.User);
      query.notEqualTo("objectId", currentUser.id); // exclude self
      const results = await query.find();

      userListDiv.innerHTML = "";

      // Add self at top
      const selfItem = document.createElement("div");
      selfItem.className = "user-item self";
      selfItem.textContent = currentUser.get("username") + " (You)";
      userListDiv.appendChild(selfItem);

      // Add other users
      results.forEach(user => {
        const div = document.createElement("div");
        div.className = "user-item";
        div.textContent = user.get("username");
        div.onclick = () => selectFriend(user);
        userListDiv.appendChild(div);
      });

      if (results.length === 0) {
        userListDiv.innerHTML += "<p>No other users found</p>";
      }

    } catch (error) {
      console.error("Error loading users:", error);
      userListDiv.innerHTML = "<p>Error loading users</p>";
    }
  }

  function selectFriend(user) {
    selectedFriend = user;
    alert("Selected friend: " + user.get("username"));
    // Later: load messages for this friend
  }

  async function initChat() {
    currentUser = Parse.User.current();
    if (!currentUser) {
      window.location.href = "login.html";
      return;
    }
    loadUsers();
  }

  window.onload = initChat;
</script>
</head>
<body>
  <div class="side-panel">
    <h2>Users</h2>
    <div id="userList"></div>
  </div>
  <div class="chat-container">
    <div class="messages" id="messages"></div>
    <div class="input-container">
      <input type="text" id="messageInput" placeholder="Type a message...">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>
</body>
</html>
